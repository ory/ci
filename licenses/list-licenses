#!/bin/sh
set -e

# list Node licenses
if [ -f package.json ]; then
	npm exec --yes license-checker -- --csv --production --excludePrivatePackages --customPath .bin/license-template-node.json
	{ echo; } 2>/dev/null
fi

# list Go licenses
if [ -f go.mod ]; then
	module_name=$(grep "^module" go.mod | awk '{print $2}')
	if [ -z "$module_name" ]; then
		echo "Cannot determine the Go module name" >&2
		exit 1
	fi
	.bin/go-licenses report "$module_name" --template .bin/license-template-go.tpl 2>/dev/null
	{ echo; } 2>/dev/null
fi
